# üîê Environment Variables Guide

Complete guide to all environment variables needed for deployment.

---

## üìã Quick Reference

| Variable | Backend | Frontend | Required | Where to Get |
|----------|---------|----------|----------|--------------|
| `SUPABASE_URL` | ‚úÖ | ‚ùå | Yes | Supabase Dashboard |
| `SUPABASE_KEY` | ‚úÖ | ‚ùå | Yes | Supabase Dashboard |
| `JWT_SECRET_KEY` | ‚úÖ | ‚ùå | Yes | Auto-generate |
| `PAYSTACK_SECRET_KEY` | ‚úÖ | ‚ùå | Yes | Paystack Dashboard |
| `PAYSTACK_PUBLIC_KEY` | ‚úÖ | ‚ùå | Yes | Paystack Dashboard |
| `FRONTEND_URL` | ‚úÖ | ‚ùå | Yes | Vercel URL |
| `VITE_API_URL` | ‚ùå | ‚úÖ | Yes | Render URL |
| `EMAIL_API_KEY` | ‚úÖ | ‚ùå | No | Resend/SendGrid |

---

## üîß Backend Environment Variables (Render)

### Required Variables

#### 1. **PYTHON_VERSION**
```
Value: 3.11.0
Purpose: Specifies Python runtime version
Source: Fixed value
```

#### 2. **ENVIRONMENT**
```
Value: production
Purpose: Sets application mode
Source: Fixed value
Note: Use 'development' for local, 'production' for Render
```

#### 3. **SUPABASE_URL**
```
Value: https://your-project.supabase.co
Purpose: Database connection endpoint
Source: Supabase Dashboard

How to get:
1. Go to https://app.supabase.com
2. Select your project
3. Settings ‚Üí API
4. Copy "Project URL"

Example: https://abcdefghijklmnop.supabase.co
```

#### 4. **SUPABASE_KEY**
```
Value: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Purpose: Database authentication key
Source: Supabase Dashboard

How to get:
1. Go to https://app.supabase.com
2. Select your project
3. Settings ‚Üí API
4. Copy "anon public" key (NOT service_role!)

Example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZ...

‚ö†Ô∏è WARNING: Use "anon" key, NOT "service_role" key!
```

#### 5. **JWT_SECRET_KEY**
```
Value: [Auto-generated by Render]
Purpose: Signs JWT tokens for authentication
Source: Auto-generate in Render

How to set:
1. In Render environment variables
2. Click "Generate Value" button
3. Render creates a secure random key

‚ö†Ô∏è IMPORTANT: Never share this key! Keep it secret!
```

#### 6. **JWT_ALGORITHM**
```
Value: HS256
Purpose: JWT signing algorithm
Source: Fixed value
```

#### 7. **ACCESS_TOKEN_EXPIRE_MINUTES**
```
Value: 30
Purpose: How long JWT tokens are valid
Source: Your preference

Options:
- 15: More secure, users login more often
- 30: Balanced (recommended)
- 60: Less secure, better UX
```

#### 8. **PAYSTACK_SECRET_KEY**
```
Value: sk_test_... (test) or sk_live_... (production)
Purpose: Process payments
Source: Paystack Dashboard

How to get:
1. Go to https://dashboard.paystack.com
2. Settings ‚Üí API Keys & Webhooks
3. Copy "Test Secret Key" (for testing)
4. Copy "Live Secret Key" (for production)

Example (test): sk_test_abc123def456ghi789jkl
Example (live): sk_live_abc123def456ghi789jkl

‚ö†Ô∏è Start with TEST keys, switch to LIVE when ready
```

#### 9. **PAYSTACK_PUBLIC_KEY**
```
Value: pk_test_... (test) or pk_live_... (production)
Purpose: Initialize payments on frontend
Source: Paystack Dashboard

How to get:
1. Go to https://dashboard.paystack.com
2. Settings ‚Üí API Keys & Webhooks
3. Copy "Test Public Key" (for testing)
4. Copy "Live Public Key" (for production)

Example (test): pk_test_abc123def456ghi789jkl
Example (live): pk_live_abc123def456ghi789jkl
```

#### 10. **FRONTEND_URL**
```
Value: https://your-project.vercel.app
Purpose: CORS - allows frontend to call API
Source: Your Vercel deployment URL

How to get:
1. Deploy frontend to Vercel first
2. Copy the Vercel URL
3. Add to Render environment variables

Examples:
- Development: http://localhost:5173
- Production: https://grejoy-market.vercel.app
- Custom domain: https://www.yourdomain.com

‚ö†Ô∏è Must match exactly (including https://)
```

### Optional Variables

#### 11. **EMAIL_API_KEY** (Optional)
```
Value: re_...
Purpose: Send transactional emails (order confirmations, etc.)
Source: Resend or SendGrid

How to get (Resend):
1. Go to https://resend.com
2. Sign up for free account
3. API Keys ‚Üí Create API Key
4. Copy the key

Example: re_abc123def456ghi789jkl

Note: Email features disabled if not set
```

#### 12. **EMAIL_FROM** (Optional)
```
Value: noreply@yourdomain.com
Purpose: Sender email address
Source: Your domain

Requirements:
- Must be verified in email service
- Use domain you own
- Or use email service's domain

Examples:
- noreply@yourdomain.com
- orders@yourdomain.com
- support@yourdomain.com
```

---

## üé® Frontend Environment Variables (Vercel)

### Required Variables

#### 1. **VITE_API_URL**
```
Value: https://grejoy-health-api-XXXX.onrender.com
Purpose: Backend API endpoint
Source: Your Render deployment URL

How to get:
1. Deploy backend to Render first
2. Copy your Render service URL
3. Add to Vercel environment variables

Examples:
- Development: http://localhost:8000
- Production: https://grejoy-health-api.onrender.com

‚ö†Ô∏è Must include https:// (no trailing slash)
```

### Optional Variables

#### 2. **VITE_GOOGLE_ANALYTICS_ID** (Optional)
```
Value: G-XXXXXXXXXX
Purpose: Track user analytics
Source: Google Analytics

How to get:
1. Go to https://analytics.google.com
2. Create property
3. Copy Measurement ID

Example: G-ABC123DEF456
```

#### 3. **VITE_SENTRY_DSN** (Optional)
```
Value: https://...@sentry.io/...
Purpose: Error tracking
Source: Sentry

How to get:
1. Go to https://sentry.io
2. Create project
3. Copy DSN

Example: https://abc123@o123.ingest.sentry.io/456
```

---

## üìù Setting Environment Variables

### In Render (Backend)

**Method 1: During Service Creation**
```
1. When creating web service
2. Click "Advanced"
3. Add each environment variable
4. Click "Create Web Service"
```

**Method 2: After Service Creation**
```
1. Dashboard ‚Üí Your Service
2. Environment tab
3. Add/Edit environment variables
4. Service auto-restarts
```

**Method 3: Via render.yaml (Already Configured)**
```yaml
# backend/render.yaml
envVars:
  - key: SUPABASE_URL
    sync: false  # Set manually in dashboard
  - key: JWT_SECRET_KEY
    generateValue: true  # Auto-generated
```

### In Vercel (Frontend)

**Method 1: During Import**
```
1. When importing project
2. Environment Variables section
3. Add VITE_API_URL
4. Deploy
```

**Method 2: After Deployment**
```
1. Project Settings
2. Environment Variables
3. Add new variable
4. Choose environments (Production/Preview/Development)
5. Save
6. Redeploy for changes to take effect
```

**Important:** Always prefix frontend variables with `VITE_`

---

## üîí Security Best Practices

### DO ‚úÖ

- **Use Render's "Generate Value"** for JWT_SECRET_KEY
- **Use test Paystack keys** initially
- **Keep .env files in .gitignore**
- **Use different keys** for dev/prod
- **Rotate keys periodically**
- **Use HTTPS URLs** only

### DON'T ‚ùå

- **Never commit** .env files to git
- **Never share** secret keys publicly
- **Never use** service_role Supabase key
- **Never hardcode** secrets in code
- **Never use** same keys everywhere
- **Never skip** SSL/HTTPS

---

## üß™ Testing Environment Variables

### Test Backend Variables

```bash
# Test database connection
curl https://your-backend.onrender.com/api/health

# Should return:
# {"status":"healthy","environment":"production"}

# Test auth (JWT)
curl -X POST https://your-backend.onrender.com/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"password"}'

# Should return JWT token if user exists
```

### Test Frontend Variables

```bash
# Check VITE_API_URL is set
# Open browser console on your Vercel site:
console.log(import.meta.env.VITE_API_URL)

# Should print your backend URL

# Test API connection
# Try to login or browse products
# Check Network tab for API calls
```

---

## üîÑ Environment Variable Checklist

### Before Deployment

- [ ] Have Supabase account + credentials
- [ ] Have Paystack account + test keys
- [ ] Created strong JWT secret (or will auto-generate)
- [ ] Have email service (optional)
- [ ] All secrets documented (not in git!)

### Backend (Render)

- [ ] PYTHON_VERSION set
- [ ] ENVIRONMENT set to production
- [ ] SUPABASE_URL set correctly
- [ ] SUPABASE_KEY set (anon key)
- [ ] JWT_SECRET_KEY generated
- [ ] JWT_ALGORITHM set
- [ ] ACCESS_TOKEN_EXPIRE_MINUTES set
- [ ] PAYSTACK_SECRET_KEY set
- [ ] PAYSTACK_PUBLIC_KEY set
- [ ] FRONTEND_URL set (after deploying frontend)
- [ ] EMAIL_API_KEY set (optional)
- [ ] EMAIL_FROM set (optional)

### Frontend (Vercel)

- [ ] VITE_API_URL set to backend URL
- [ ] Applied to all environments
- [ ] Redeployed after adding variables

---

## üêõ Troubleshooting

### Issue: "Environment variable not found"

**Solution:**
1. Check variable name spelling
2. Verify it's set in dashboard
3. Restart service (Render) or redeploy (Vercel)
4. Frontend: Must prefix with `VITE_`

### Issue: "CORS error"

**Solution:**
1. Check FRONTEND_URL matches exactly
2. Include https://
3. No trailing slash
4. Wait for service restart

### Issue: "Database connection failed"

**Solution:**
1. Verify SUPABASE_URL format
2. Check using anon key (not service_role)
3. Test from local machine first
4. Verify Supabase project is active

### Issue: "Payment initialization failed"

**Solution:**
1. Check Paystack keys match (test/live)
2. Both secret and public keys needed
3. Verify keys are active
4. Check Paystack dashboard for errors

---

## üìû Where to Get Help

### Supabase
- Dashboard: https://app.supabase.com
- Docs: https://supabase.com/docs
- Support: Discord community

### Paystack
- Dashboard: https://dashboard.paystack.com
- Docs: https://paystack.com/docs
- Support: support@paystack.com

### Render
- Dashboard: https://dashboard.render.com
- Docs: https://render.com/docs
- Support: support@render.com

### Vercel
- Dashboard: https://vercel.com
- Docs: https://vercel.com/docs
- Support: support@vercel.com

---

## üìö Related Documentation

- `DEPLOYMENT_GUIDE.md` - Complete deployment guide
- `DEPLOYMENT_QUICK_START.md` - Quick deployment
- `backend/.env.example` - Backend variables template
- `frontend/.env.example` - Frontend variables template

---

**Keep your environment variables secure!** üîí
